{% extends 'base.html' %}

{% block content %}
<div class="container-fluid px-4 py-5">
    <!-- Header Section -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="dashboard-header text-center">
                <h1 class="display-5 fw-bold gradient-text mb-3">
                    <i class="fas fa-users-cog me-3"></i>
                    {% if form.instance.id %}Edit Trainer{% else %}Add New Trainer{% endif %}
                </h1>
                <p class="text-muted fs-5">
                    {% if form.instance.id %}
                    Update trainer information and schedule
                    {% else %}
                    Register a new trainer to your gym team
                    {% endif %}
                </p>
            </div>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-xl-8 col-lg-10">
            <!-- Premium Form Card -->
            <div class="premium-form-card">
                <div class="form-header">
                    <div class="header-icon">
                        <i class="fas fa-users-cog"></i>
                    </div>
                    <h3>Trainer Details</h3>
                    <p>Fill in the trainer's information below</p>
                </div>

                <form method="post" class="needs-validation" novalidate>
                    {% csrf_token %}
                    <br>
                    <!-- Progress Steps -->
                    <div class="form-progress mb-5">
                        <div class="progress-steps">
                            <div class="step active" data-step="1">
                                <div class="step-circle">1</div>
                                <span class="step-label">Personal Info</span>
                            </div>
                            <div class="step" data-step="2">
                                <div class="step-circle">2</div>
                                <span class="step-label">Specialization</span>
                            </div>
                            <div class="step" data-step="3">
                                <div class="step-circle">3</div>
                                <span class="step-label">Schedule & Contact</span>
                            </div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 33%"></div>
                        </div>
                    </div>

                    <!-- Step 1: Personal Information -->
                    <div class="form-step active" data-step="1">
                        <h4 class="step-title mb-4">
                            <i class="fas fa-user-circle me-2"></i>Personal Information
                        </h4>
                        
                        <div class="row g-4">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <div class="input-container">
                                        {{ form.name }}
                                        <label class="floating-label">
                                            <i class="fas fa-user me-2"></i>Full Name
                                        </label>
                                    </div>
                                    <div class="form-helper">Enter the trainer's full legal name</div>
                                    {% if form.name.errors %}
                                    <div class="error-feedback">{{ form.name.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="step-actions">
                            <button type="button" class="btn btn-next" data-next="2">
                                Next <i class="fas fa-arrow-right ms-2"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Step 2: Specialization -->
                    <div class="form-step" data-step="2">
                        <h4 class="step-title mb-4">
                            <i class="fas fa-dumbbell me-2"></i>Specialization & Expertise
                        </h4>
                        
                        <div class="row g-4">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <div class="input-container">
                                        {{ form.specialization }}
                                        <label class="floating-label">
                                            <i class="fas fa-dumbbell me-2"></i>Specialization
                                        </label>
                                    </div>
                                    <div class="form-helper">Select or enter the trainer's main specialization</div>
                                    {% if form.specialization.errors %}
                                    <div class="error-feedback">{{ form.specialization.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Specialization Cards -->
                        <div class="specialization-cards mt-4">
                            <h6 class="mb-3">Popular Specializations</h6>
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <div class="spec-card" data-spec="Personal Training">
                                        <i class="fas fa-user"></i>
                                        <span>Personal Training</span>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="spec-card" data-spec="Yoga">
                                        <i class="fas fa-spa"></i>
                                        <span>Yoga</span>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="spec-card" data-spec="CrossFit">
                                        <i class="fas fa-fire"></i>
                                        <span>CrossFit</span>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="spec-card" data-spec="Weightlifting">
                                        <i class="fas fa-weight-hanging"></i>
                                        <span>Weightlifting</span>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="spec-card" data-spec="Cardio">
                                        <i class="fas fa-running"></i>
                                        <span>Cardio</span>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="spec-card" data-spec="Nutrition">
                                        <i class="fas fa-apple-alt"></i>
                                        <span>Nutrition</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="step-actions">
                            <button type="button" class="btn btn-prev" data-prev="1">
                                <i class="fas fa-arrow-left me-2"></i>Previous
                            </button>
                            <button type="button" class="btn btn-next" data-next="3">
                                Next <i class="fas fa-arrow-right ms-2"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Step 3: Schedule & Contact -->
                    <div class="form-step" data-step="3">
                        <h4 class="step-title mb-4">
                            <i class="fas fa-calendar-alt me-2"></i>Schedule & Contact Information
                        </h4>
                        
                        <div class="row g-4">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <div class="input-container">
                                        {{ form.schedule }}
                                        <label class="floating-label">
                                            <i class="fas fa-calendar-alt me-2"></i>Schedule
                                        </label>
                                    </div>
                                    <div class="form-helper">e.g., Mon-Fri 9AM-6PM, Weekends 10AM-4PM</div>
                                    {% if form.schedule.errors %}
                                    <div class="error-feedback">{{ form.schedule.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <div class="input-container">
                                        {{ form.contact }}
                                        <label class="floating-label">
                                            <i class="fas fa-phone-alt me-2"></i>Contact Number
                                        </label>
                                    </div>
                                    <div class="form-helper">Include country code if international</div>
                                    {% if form.contact.errors %}
                                    <div class="error-feedback">{{ form.contact.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Schedule Preview -->
                        <div class="schedule-preview mt-4">
                            <h6 class="mb-3">Schedule Preview</h6>
                            <div class="preview-card">
                                <div class="preview-content">
                                    <i class="fas fa-clock"></i>
                                    <span id="schedule-preview-text">Enter schedule to see preview</span>
                                </div>
                            </div>
                        </div>

                        <div class="step-actions">
                            <button type="button" class="btn btn-prev" data-prev="2">
                                <i class="fas fa-arrow-left me-2"></i>Previous
                            </button>
                            <button type="submit" class="btn btn-submit">
                                <i class="fas fa-save me-2"></i>
                                {% if form.instance.id %}Update Trainer{% else %}Create Trainer{% endif %}
                            </button>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions mt-4">
                <div class="row g-3">
                    <div class="col-md-6">
                        <a href="{% url 'trainers_list' %}" class="action-btn back-btn">
                            <i class="fas fa-arrow-left me-2"></i>Back to Trainers List
                        </a>
                    </div>
                    <div class="col-md-6">
                        <button type="button" class="action-btn clear-btn" id="clear-form">
                            <i class="fas fa-broom me-2"></i>Clear Form
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Premium Styling -->
<style>
    :root {
        --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        --card-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        --hover-shadow: 0 30px 60px rgba(0, 0, 0, 0.15);
    }

    /* Force light theme styles - prevent dark mode override */
    .premium-form-card,
    .form-header,
    .form-step,
    .specialization-cards,
    .schedule-preview,
    .spec-card,
    .preview-card,
    .form-control,
    .input-container {
        /* Important: Force light theme colors */
        background: white !important;
        color: #2d3748 !important;
    }

    /* Header Styling */
    .dashboard-header {
        padding: 2rem 0;
    }

    .gradient-text {
        background: linear-gradient(135deg, #667eea, #764ba2, #f093fb);
        background-size: 300% 300%;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: gradientShift 3s ease infinite;
    }

    @keyframes gradientShift {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    /* Premium Form Card */
    .premium-form-card {
        border-radius: 20px;
        box-shadow: var(--card-shadow);
        overflow: hidden;
        transition: all 0.3s ease;
    }

    .premium-form-card:hover {
        box-shadow: var(--hover-shadow);
    }

    .form-header {
        background: var(--primary-gradient) !important;
        color: white !important;
        padding: 2.5rem;
        text-align: center;
        position: relative;
        overflow: hidden;
    }

    .form-header::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255,255,255,0.1) 1%, transparent 1%);
        background-size: 20px 20px;
        animation: float 20s linear infinite;
    }

    .header-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
        opacity: 0.9;
    }

    .form-header h3 {
        font-size: 1.8rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }

    .form-header p {
        opacity: 0.9;
        margin: 0;
    }

    /* Progress Steps */
    .form-progress {
        padding: 0 2.5rem;
    }

    .progress-steps {
        display: flex;
        justify-content: space-between;
        position: relative;
        margin-bottom: 1rem;
    }

    .step {
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
        z-index: 2;
    }

    .step-circle {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: #e9ecef;
        color: #6c757d;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        transition: all 0.3s ease;
        border: 3px solid #e9ecef;
    }

    .step.active .step-circle {
        background: var(--primary-gradient);
        color: white;
        border-color: #667eea;
        transform: scale(1.1);
    }

    .step-label {
        margin-top: 0.5rem;
        font-size: 0.875rem;
        font-weight: 500;
        color: #6c757d;
        transition: all 0.3s ease;
    }

    .step.active .step-label {
        color: #667eea;
        font-weight: 600;
    }

    .progress-bar {
        height: 6px;
        background: #e9ecef;
        border-radius: 3px;
        overflow: hidden;
        position: relative;
    }

    .progress-fill {
        height: 100%;
        background: var(--primary-gradient);
        border-radius: 3px;
        transition: width 0.5s ease;
    }

    /* Form Steps */
    .form-step {
        padding: 2.5rem;
        display: none;
    }

    .form-step.active {
        display: block;
        animation: fadeInUp 0.6s ease;
    }

    .step-title {
        color: #2d3748;
        font-weight: 600;
        border-bottom: 2px solid #e9ecef;
        padding-bottom: 1rem;
    }

    /* Fixed Form Groups - No Overlap */
    .form-group {
        position: relative;
        margin-bottom: 1.5rem;
    }

    .input-container {
        position: relative;
        margin-bottom: 0.5rem;
    }

    .form-control {
        border: 2px solid #e9ecef !important;
        border-radius: 12px;
        padding: 1.5rem 1rem 0.5rem !important;
        font-size: 1rem;
        transition: all 0.3s ease;
        background: #f8f9fa !important;
        height: auto;
        width: 100%;
        color: #2d3748 !important;
    }

    .form-control:focus {
        border-color: #667eea !important;
        background: white !important;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        outline: none;
    }

    /* Fixed Floating Labels - No Overlap */
    .floating-label {
        position: absolute;
        top: 0.75rem;
        left: 1rem;
        color: #6c757d;
        transition: all 0.3s ease;
        pointer-events: none;
        font-size: 1rem;
        background: transparent;
        padding: 0 0.25rem;
        z-index: 2;
    }

    .form-control:focus + .floating-label,
    .form-control:not(:placeholder-shown) + .floating-label {
        top: 0.25rem;
        font-size: 0.75rem;
        color: #667eea;
        font-weight: 600;
        background: linear-gradient(transparent 50%, #f8f9fa 50%);
    }

    .form-control:focus + .floating-label {
        background: linear-gradient(transparent 50%, white 50%);
    }

    .form-helper {
        font-size: 0.875rem;
        color: #6c757d;
        margin-top: 0.25rem;
        padding: 0 1rem;
    }

    /* Specialization Cards - Fixed for Dark Mode */
    .specialization-cards {
        border: 2px dashed #e9ecef;
        border-radius: 15px;
        padding: 1.5rem;
        background: #fafbfc !important;
    }

    .spec-card {
        background: white !important;
        border: 2px solid #e9ecef;
        border-radius: 12px;
        padding: 1rem;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.5rem;
        color: #2d3748 !important;
    }

    .spec-card:hover {
        border-color: #667eea;
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
    }

    .spec-card.active {
        border-color: #667eea;
        background: var(--primary-gradient) !important;
        color: white !important;
    }

    .spec-card i {
        font-size: 1.5rem;
        margin-bottom: 0.5rem;
        color: inherit !important; /* Inherit color from parent */
    }

    .spec-card span {
        font-size: 0.875rem;
        font-weight: 500;
        color: inherit !important; /* Inherit color from parent */
    }

    /* Schedule Preview */
    .schedule-preview {
        border: 2px dashed #e9ecef;
        border-radius: 15px;
        padding: 1.5rem;
        background: #fafbfc !important;
    }

    .preview-card {
        background: white !important;
        border-radius: 12px;
        padding: 1rem;
        border: 2px solid #e9ecef;
    }

    .preview-content {
        display: flex;
        align-items: center;
        gap: 1rem;
        color: #6c757d !important;
    }

    .preview-content i {
        font-size: 1.25rem;
        color: #667eea !important;
    }

    /* Buttons */
    .step-actions {
        display: flex;
        justify-content: space-between;
        margin-top: 2rem;
        padding-top: 2rem;
        border-top: 2px solid #e9ecef;
    }

    .btn {
        padding: 0.75rem 2rem;
        border-radius: 12px;
        font-weight: 600;
        border: none;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }

    .btn-prev {
        background: #6c757d;
        color: white;
    }

    .btn-prev:hover {
        background: #5a6268;
        transform: translateX(-3px);
    }

    .btn-next, .btn-submit {
        background: var(--primary-gradient);
        color: white;
    }

    .btn-next:hover, .btn-submit:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
    }

    /* Quick Actions */
    .quick-actions {
        display: flex;
        gap: 1rem;
    }

    .action-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 1rem 2rem;
        border-radius: 12px;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s ease;
        border: 2px solid;
        flex: 1;
    }

    .back-btn {
        background: #6c757d;
        color: white;
        border-color: #6c757d;
    }

    .back-btn:hover {
        background: #5a6268;
        color: white;
        transform: translateX(-3px);
    }

    .clear-btn {
        background: white !important;
        color: #dc3545 !important;
        border-color: #dc3545;
    }

    .clear-btn:hover {
        background: #dc3545 !important;
        color: white !important;
        transform: translateY(-3px);
    }

    /* Error Styling */
    .error-feedback {
        color: #dc3545;
        font-size: 0.875rem;
        margin-top: 0.25rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .error-feedback::before {
        content: "âš ";
    }

    .form-control.is-invalid {
        border-color: #dc3545 !important;
    }

    /* Animations */
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes float {
        0% { transform: translate(0, 0) rotate(0deg); }
        100% { transform: translate(-20px, -20px) rotate(360deg); }
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .form-header {
            padding: 2rem 1.5rem;
        }

        .form-step {
            padding: 1.5rem;
        }

        .progress-steps {
            flex-direction: column;
            gap: 1rem;
        }

        .step {
            flex-direction: row;
            gap: 1rem;
        }

        .step-label {
            margin-top: 0;
        }

        .step-actions {
            flex-direction: column;
            gap: 1rem;
        }

        .btn {
            width: 100%;
        }

        .quick-actions {
            flex-direction: column;
        }

        .form-control {
            padding: 1.25rem 0.75rem 0.5rem !important;
        }

        .floating-label {
            left: 0.75rem;
            top: 0.6rem;
        }

        .form-control:focus + .floating-label,
        .form-control:not(:placeholder-shown) + .floating-label {
            top: 0.2rem;
            left: 0.75rem;
        }
    }
</style>

<!-- Interactive JavaScript -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Multi-step form functionality
        const steps = document.querySelectorAll('.form-step');
        const progressFill = document.querySelector('.progress-fill');
        let currentStep = 1;

        // Initialize form
        initializeForm();

        // Next button functionality
        document.querySelectorAll('.btn-next').forEach(button => {
            button.addEventListener('click', function() {
                const nextStep = parseInt(this.dataset.next);
                if (validateStep(currentStep)) {
                    navigateToStep(nextStep);
                }
            });
        });

        // Previous button functionality
        document.querySelectorAll('.btn-prev').forEach(button => {
            button.addEventListener('click', function() {
                const prevStep = parseInt(this.dataset.prev);
                navigateToStep(prevStep);
            });
        });

        // Specialization cards
        document.querySelectorAll('.spec-card').forEach(card => {
            card.addEventListener('click', function() {
                const specialization = this.dataset.spec;
                const specializationField = document.getElementById('id_specialization');
                
                // Remove active class from all cards
                document.querySelectorAll('.spec-card').forEach(c => {
                    c.classList.remove('active');
                });
                
                // Add active class to clicked card
                this.classList.add('active');
                
                // Set field value
                specializationField.value = specialization;
                specializationField.focus();
                
                // Trigger floating label update
                updateFloatingLabel(specializationField);
            });
        });

        // Schedule preview
        const scheduleField = document.getElementById('id_schedule');
        const schedulePreview = document.getElementById('schedule-preview-text');
        
        if (scheduleField) {
            scheduleField.addEventListener('input', function() {
                schedulePreview.textContent = this.value || 'Enter schedule to see preview';
                updateFloatingLabel(this);
            });
        }

        // Clear form button
        document.getElementById('clear-form').addEventListener('click', function() {
            if (confirm('Are you sure you want to clear all form data?')) {
                document.querySelector('form').reset();
                // Reset all floating labels
                document.querySelectorAll('.form-control').forEach(field => {
                    updateFloatingLabel(field);
                });
                // Reset specialization cards
                document.querySelectorAll('.spec-card').forEach(card => {
                    card.classList.remove('active');
                });
                navigateToStep(1);
            }
        });

        // Form validation on submit
        document.querySelector('form').addEventListener('submit', function(e) {
            if (!validateForm()) {
                e.preventDefault();
                showNotification('Please fill in all required fields correctly.', 'error');
            }
        });

        function initializeForm() {
            // Initialize all floating labels based on current values
            document.querySelectorAll('.form-control').forEach(field => {
                updateFloatingLabel(field);
                
                // Add input events for real-time updates
                field.addEventListener('input', function() {
                    updateFloatingLabel(this);
                });
            });
        }

        function updateFloatingLabel(field) {
            const label = field.parentElement.querySelector('.floating-label');
            if (field.value) {
                label.style.cssText = `
                    top: 0.25rem;
                    font-size: 0.75rem;
                    color: #667eea;
                    font-weight: 600;
                    background: linear-gradient(transparent 50%, #f8f9fa 50%);
                `;
            } else {
                label.style.cssText = `
                    top: 0.75rem;
                    font-size: 1rem;
                    color: #6c757d;
                    font-weight: 400;
                    background: transparent;
                `;
            }
            
            // Update background for focused state
            if (field === document.activeElement) {
                label.style.background = 'linear-gradient(transparent 50%, white 50%)';
            }
        }

        function navigateToStep(step) {
            // Hide current step
            document.querySelector(`.form-step[data-step="${currentStep}"]`).classList.remove('active');
            document.querySelector(`.step[data-step="${currentStep}"]`).classList.remove('active');

            // Show new step
            document.querySelector(`.form-step[data-step="${step}"]`).classList.add('active');
            document.querySelector(`.step[data-step="${step}"]`).classList.add('active');

            // Update progress bar
            const progressPercentage = ((step - 1) / (steps.length - 1)) * 100;
            progressFill.style.width = `${progressPercentage}%`;

            currentStep = step;
        }

        function validateStep(step) {
            let isValid = true;
            const currentStepElement = document.querySelector(`.form-step[data-step="${step}"]`);

            // Validate required fields in current step
            const requiredFields = currentStepElement.querySelectorAll('[required]');
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    field.classList.add('is-invalid');
                    isValid = false;
                } else {
                    field.classList.remove('is-invalid');
                }
            });

            return isValid;
        }

        function validateForm() {
            let isValid = true;

            document.querySelectorAll('[required]').forEach(field => {
                if (!field.value.trim()) {
                    field.classList.add('is-invalid');
                    isValid = false;
                } else {
                    field.classList.remove('is-invalid');
                }
            });

            return isValid;
        }

        function showNotification(message, type) {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `alert alert-${type === 'error' ? 'danger' : 'success'} alert-dismissible fade show position-fixed`;
            notification.style.cssText = `
                top: 20px;
                right: 20px;
                z-index: 9999;
                min-width: 300px;
                border-radius: 12px;
                border: none;
                box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            `;
            notification.innerHTML = `
                <div class="d-flex align-items-center">
                    <i class="fas fa-${type === 'error' ? 'exclamation-triangle' : 'check-circle'} me-2"></i>
                    <span>${message}</span>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;

            document.body.appendChild(notification);

            // Auto remove after 5 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 5000);
        }

        // Add real-time validation
        document.querySelectorAll('.form-control').forEach(field => {
            field.addEventListener('blur', function() {
                if (this.hasAttribute('required') && !this.value.trim()) {
                    this.classList.add('is-invalid');
                } else {
                    this.classList.remove('is-invalid');
                }
            });
        });

        // Initialize all fields on load
        document.querySelectorAll('.form-control').forEach(field => {
            updateFloatingLabel(field);
        });
    });
</script>
{% endblock %}
